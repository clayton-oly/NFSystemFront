<div class="container mt-4">
  <h2>Edição da Nota Fiscal Nº {{ nota?.numero }}</h2>

  <form [formGroup]="notaForm" class="mt-3">
    <div class="mb-3">
      <label>Número</label>
      <input type="text" formControlName="numero" class="form-control" disabled />
    </div>

    <div class="mb-3">
      <label>Status</label>
      <input type="text" formControlName="status" class="form-control" disabled />
    </div>
  </form>

  <hr />

  <h4>Itens da Nota</h4>

  <div class="mb-3 d-flex" *ngIf="!notaFechada">
    <select #produtoSelect class="form-select me-2" style="width: 300px;">
      <option value="">Selecione um produto</option>
      <option *ngFor="let p of produtos" [value]="p.id">{{ p.descricao }}</option>
    </select>
    <button class="btn btn-success" (click)="adicionarItem(produtoSelect.value)" [disabled]="!produtoSelect.value">
      Adicionar
    </button>
  </div>

  <table class="table table-bordered mt-3">
    <thead>
      <tr>
        <th>Produto</th>
        <th>Quantidade</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of itens; let i = index">
        <td>{{ item.descricao }}</td>
        <td>
          <input
            type="number"
            min="1"
            [(ngModel)]="item.quantidade"
            [disabled]="notaFechada"
            class="form-control"
            style="width: 100px;"
          />
        </td>
        <td>
          <button class="btn btn-danger btn-sm" (click)="removerItem(i)" [disabled]="notaFechada">
            Remover
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="mt-4">
    <button class="btn btn-primary me-2" (click)="salvar()" [disabled]="notaFechada">Salvar</button>
    <button class="btn btn-secondary me-2" (click)="voltar()">Cancelar</button>
    <button class="btn btn-dark" *ngIf="!notaFechada" (click)="fecharNota()">Fechar Nota</button>
  </div>
</div>
